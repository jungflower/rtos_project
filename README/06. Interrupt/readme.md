# 6. 인터럽트
`인터럽트`란?  
- CPU가 프로그램을 순차적으로 실행하는 도중, 갑작스럽게 발생한 사건(외부 신호 등)을 즉시 처리하기 위해 현재 실행 흐름을 잠시 중단시키고, 해당 사건 처리 루틴으로 제어를 넘기는 매커니즘.  

인터럽트 처리를 위해서는 `인터럽트 컨트롤러`를 초기화하고 사용하는 코드 작성 필요 -> 실제 인터럽트를 발생시키는 하드웨어와 인터럽트 컨트롤러를 연결  

👉 **ARM 기반 MCU에서 인터럽트 처리 과정**  
`하드웨어 → 인터럽트 컨트롤러 → CPU 예외 발생 → 핸들러 실행`  

1. 하드웨어 이벤트 발생
- 해당 하드웨어는 인터럽트 요청 (IRQ 신호 / FIQ 신호)을 인터럽트 컨트롤러에 전달  

2. 인터럽트 컨트롤러 
- 여러 장치에서 올라온 인터럽트를 관리  
- 선택된 인터럽트를 CPU(코어)에 전달  

3. CPU (ARM 코어)  
- `CPSR` 레지스터의 I(IRQ Mask), F(FIQ Mask) 비트 상태 확인  
    - `I=0` -> IRQ  허용
    - `F=0` -> FIQ 허용  
- 허용 상태라면 Exception 발생으로 간주하고 PC를 해당 Exception vector로 jump  

4. Exception Vector -> 핸들러 실행  
- ARM은 인터럽트 종류별로 고정된 주소(예외 벡터 테이블)을 갖고 있음  
- 벡터 주소에 작성된 익셉션 핸들러 코드로 제어가 이동  
이때 CPU는 일부 레지스터(PC, CPSR 등)을 스택이나 전용 모드 레지스터에 저장  

5. 인터럽트 서비스 루틴(ISR, 핸들러)  
- 펌웨어에서 작성하는 부분  
    1. 컨텍스트 저장(일부 레지스터 푸시)  
    2. 인터럽트 발생 원인 확인 (UART의 RT/TX 상태 레지스터 읽기)  
    3. 해당 작업 처리 (데이터 읽기/쓰기, 플래그 클리어)  
    4. 컨텍스트 복원  
    5. eret등으로 원래 코드로 복귀

6. 원래 실행중이던 프로그램 복귀  
- ISR 수행 끝나면 저장해두었던 레지스터 상태 복원하고 중단했던 지점부터 정상 실행을 이어감.  

### 6.1 인터럽트 컨트롤러  
- RealViewPB에서는 인터럽트 컨트롤러를 `GIC(Generic Intterrupt Controller)`라 부른다.  

1. GIC 레지스터 구조체 만들기
